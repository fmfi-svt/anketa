{% extends 'AnketaBundle::layout.html.twig' %}

{% block title %}{{ title|default("") }}{% endblock %}
{% block navigation %}
    {{ menu.statistics.render(activeMenuItems)|raw }}
{% endblock %}
{% block content %}
    <script type="text/javascript" src="{{ asset('bundles/anketa/js/reD3/line.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/anketa/js/reD3/util.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/anketa/js/reD3/dayhourheatmap.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/anketa/js/reD3/d3.min.js') }}"></script>

    <link rel="stylesheet" href="{{ asset('bundles/anketa/css/reD3/line.css') }}" type="text/css" media="all">
    <link rel="stylesheet" href="{{ asset('bundles/anketa/css/reD3/heatmap.css') }}" type="text/css" media="all">

	<h2>V ktory den/hodinu zacali studenti vyplnat anketu?</h2>
	<div id="heatmap"></div>

    	<h2> Kedy studenti skoncili s vyplnanim ankety? </h2>
	<div id="finish-chart"></div>

    	<h2> Kedy zacali studenti vyplnat anketu? </h2>
    	<div id="start-chart"></div>

    	<h2> Ako dlho studentom trvalo vyplnit anketu? </h2>
<script type="text/javascript">
	
var el = document.getElementById('start-chart');
var startline = new reD3.Line(el, {
    width: 550,
    height: 250,
    xValue: 'date',
    yValue: 'close',
    margin: {
        top: 20
    }
});

var parse = d3.time.format("%Y-%m-%d").parse;

d3.csv("{{ path('statistics_stats_started_daily', {'season_slug': season_slug}) }}", 
	function(error, data){
		data.forEach(function(d){
			d.date = parse(d.dates);
			d.close = +d.counts;
		});
		console.log(data);
		startline.render(data);
	});


el = document.getElementById('finish-chart');
var finishline = new reD3.Line(el, {
    width: 550,
    height: 250,
    xValue: 'date',
    yValue: 'close',
    margin: {
        top: 20
    }
});

d3.csv("{{ path('statistics_stats_finished_daily', {'season_slug': season_slug}) }}", 
	function(error, data){
		data.forEach(function(d){
			d.date = parse(d.dates);
			d.close = +d.counts;
		});
		finishline.render(data);
	});


el = document.getElementById('heatmap');
var heatmap = new reD3.DayHourHeatmap(el, {
	width: 500,
	height: 250
});

d3.csv("{{ path('statistics_stats_started_weekday_hour', {'season_slug': season_slug}) }}", function(error, data) {
    data.forEach(function(d) {
        d.day= +d.weekday;
        d.hour= +d.hour + 1;
        d.value= +d.counts;
    });
    heatmap.render(data);
});
    </script>

    <script src="{{ asset('bundles/anketa/js/reports.js') }}" type="text/javascript"></script>
{% endblock %}

